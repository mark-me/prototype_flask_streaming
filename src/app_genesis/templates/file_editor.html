{% extends "base.html" %}
{% block title %}Config bewerken{% endblock %}

{% block content %}
<div class="d-flex justify-content-between mt-3">

  <h2>{{ file_type.upper() }} bewerken</h2>
  {% if read_only %}
    <a href="#" onclick="close_window(warning=false);return false;" class="btn btn-close" aria-label="Close">
  {% else %}
    <a href="#" onclick="close_window(warning=true);return false;" class="btn btn-close" aria-label="Close">
  {% endif %}
  </a>
</div>

<form method="post" class="mt-3">
  <textarea id="editor" name="content" rows="20" class="form-control">{{ content | e }}</textarea>

  {% if not read_only %}
    <div class="d-flex justify-content-between mt-3">
        <!-- Gewoon opslaan -->
        <button type="submit" name="action" value="save" class="btn btn-success">Opslaan</button>

        <!-- Opslaan als -->
        <div class="input-group" style="max-width: 400px;">
            <input type="text" name="new_name" class="form-control" placeholder="Nieuwe bestandsnaam">
            <button type="submit" name="action" value="save_as" class="btn btn-warning">Opslaan als</button>
        </div>
    </div>
  {% endif %}
</form>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="mt-3">
    {% for category, message in messages %}
      <div class="alert alert-{{ category }}">{{ message }}</div>
    {% endfor %}
    </div>
  {% endif %}
{% endwith %}

{% endblock %}

{% block scripts %}
  <script>
    // Verkrijg de file_type en read_only variabelen van Jinja2
    var fileType = "{{ file_type }}";  // 'yaml', 'json', 'sql', etc.
    var readOnly = {{ read_only | tojson }};  // true of false

    // Bepaal de juiste mode op basis van het file_type
    var mode = 'yaml';  // Standaard mode
    if (fileType === 'json') {
        mode = 'application/json';
    } else if (fileType === 'sql') {
        mode = 'sql';
    }

    const editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
        mode: mode,
        theme: "material-darker",
        readOnly: readOnly,
        lineNumbers: true,
        lineWrapping: true,
        styleActiveLine: true,
        foldGutter: true,          // Sta code folding toe
        gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"], // Voeg gutter voor folding toe
    });
    editor.setSize("100%", "500px");
  </script>
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
{% endblock %}