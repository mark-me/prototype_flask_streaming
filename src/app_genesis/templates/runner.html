{% extends "base.html" %}
{% block title %}Genesis draait{% endblock %}

{% block content %}
    <div id="config" data-filename="{{ config }}"></div>
    <h1>Genesis draait met <code>{{ config }}</code></h1>

    <div class="card mt-3">
        <div class="card-body console-box" id="console"></div>
    </div>

    <div class="mt-3 d-flex gap-2">
        <div id="question-buttons" style="display:none;">
            <button class="btn btn-success" onclick="sendInput('J')">Ja</button>
            <button class="btn btn-danger" onclick="sendInput('N')">Nee</button>
        </div>

        <a class="btn btn-outline-secondary" href="{{ url_for('index') }}">Terug</a>

        <div id="download-button" style="display:none;">
        </div>
    </div>

    {% include "_modal.html" %}
{% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', filename='js/runner.js') }}"></script>
    <script src="{{ url_for('static', filename='js/modal.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialiseer modal met tab-sync
            if (typeof setupModalCleanup === 'function') {
                setupModalCleanup();
            }

            // Haal de huidige config-filename op (uit de template)
            const configFile = document.getElementById('config').dataset.filename;
            if (!configFile) {
                console.error('Geen config-filename gevonden!');
                return;
            }

            // Start polling voor status-updates (elke 1s)
            if (typeof startPolling === 'function') {
                startPolling('/runner/status', function(statusData) {
                    const status = statusData[configFile];
                    if (status && status.status === 'awaiting_input' && status.prompt) {
                        // Trigger modal alleen op focused tab (via broadcast)
                        if (typeof showModal === 'function') {
                            showModal(configFile, status.prompt, { broadcast: true });
                        }
                    }
                });
            }

            // Bestaande runner.js initialisatie (SSE voor console) gebeurt al via defer
        });
    </script>
{% endblock %}
