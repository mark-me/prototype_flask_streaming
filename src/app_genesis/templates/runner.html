{% extends "base.html" %}
{% block title %}Genesis draait{% endblock %}

{% block content %}
    <h1>Genesis draait met <code>{{ config }}</code></h1>

    <div id="config" data-filename="{{ config }}"></div>

    <div class="card mt-3">
        <div class="card-body console-box" id="console"></div>
    </div>

    <div class="mt-3 d-flex gap-2">
        <div id="question-buttons" style="display:none;">
            <button class="btn btn-success" onclick="sendInput('J')">Ja</button>
            <button class="btn btn-danger" onclick="sendInput('N')">Nee</button>
        </div>

        <a class="btn btn-outline-secondary" href="{{ url_for('index') }}">Terug</a>

        <div id="download-button" style="display:none;">
        </div>
    </div>

    {% include "_modal.html" %}
{% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', filename='js/runner.js') }}"></script>
    <script type="module">
        import { startPolling, stopPolling, showModal, sendModalInput, setupModalCleanup }
        from "{{ url_for('static', filename='js/modal.js') }}";

        window.addEventListener('DOMContentLoaded', () => {
            if (!document.getElementById('inputModal')) {
                console.warn('Modal element ontbreekt, polling zal doorgaan zonder modal.');
            }

            setupModalCleanup();

            function updateRunnerStatus(data) {
                if (data.awaiting_input) {
                    showModal(data.filename, data.prompt);
                }
            }

            startPolling('/runner/status', updateRunnerStatus, 1000);

            window.sendInput = (answer) => {
                const filename = document.getElementById('modal-filename').innerText;
                sendModalInput(filename, answer, '/runner/input');
            };
        });
    </script>
{% endblock %}
